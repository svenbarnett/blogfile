<!DOCTYPE HTML><html lang="zh-CN"><head><meta charset="utf-8"><title>linux生产免费的域名证书 | 人间日常 | 所行皆过往，所愿皆成真</title><meta name="author" content="SIWEN.PENG"><meta name="description" content="Linux下使用acme.sh 配置https 免费证书"><meta name="keywords" content="linux,cert,acme.sh,psw,彭思文,siwen,思文,sven,java,study,solution,blog"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,minimal-ui"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta property="og:title" content="linux生产免费的域名证书"><meta property="og:site_name" content="人间日常"><meta property="og:image" content="867078-20190326175923357-720763416.png"><link href="/avatar.jpg" rel="icon"><link rel="alternate" href="/atom.xml" title="人间日常" type="application/atom+xml"><link rel="stylesheet" href="/css/style.css" media="screen" type="text/css"><link rel="stylesheet" href="/css/custom.css" media="screen" type="text/css"><meta name="generator" content="Hexo 6.3.0"></head><body><div class="blog"><div class="content"><header><div class="site-branding"><h1 class="site-title"><a href="/">人间日常</a></h1><p class="site-description">所行皆过往，所愿皆成真</p></div><nav class="site-navigation"><ul><li><a href="/">主页</a></li><li><a href="/archives/">归档</a></li><li><a href="/pics/">图记</a></li></ul></nav></header><main class="site-main posts-loop"><div id="container"><article><h3 class="article-title"><span>linux生产免费的域名证书</span></h3><div class="article-top-meta"><span class="posted-on"><a href="/p/4425fc35/" rel="bookmark"><time class="entry-date published" datetime="2021-12-29T13:59:07.000Z">2021-12-29</time></a></span></div><div class="article-content"><div class="entry"><p><a target="_blank" rel="external nofollow noopener noreferrer" href="http://xn--acme-kt0gs67hmo3a2r1a.sh">简单来说 acme.sh</a> 实现了 acme 协议，可以从 let‘s encrypt 生成免费的证书。<br><a target="_blank" rel="external nofollow noopener noreferrer" href="http://acme.sh">acme.sh</a> 有以下特点：<br>一个纯粹用 Shell（Unix shell）语言编写的 ACME 协议客户端。<br>完整的 ACME 协议实施。 支持 ACME v1 和 ACME v2 支持 ACME v2 通配符证书<br>简单，功能强大且易于使用。你只需要 3 分钟就可以学习它。<br>Let’s Encrypt 免费证书客户端最简单的 shell 脚本。<br>纯粹用 Shell 编写，不依赖于 python 或官方的 Let’s Encrypt 客户端。<br>只需一个脚本即可自动颁发，续订和安装证书。 不需要 root/sudoer 访问权限。<br>支持在 Docker 内使用，支持 IPv6</p><span id="more"></span><p><strong>安装环境：</strong><br><strong>操作系统：centos 7 X64</strong><br><strong>SSL 证书来源：Let’s Encrypt</strong><br><strong>安装用脚本：<a target="_blank" rel="external nofollow noopener noreferrer" href="http://acme.sh">acme.sh</a></strong><br><strong>服务器：nginx</strong><br><strong>域名：<a target="_blank" rel="external nofollow noopener noreferrer" href="http://epoint.pswen.cn">epoint.pswen.cn</a></strong></p><p><a target="_blank" rel="external nofollow noopener noreferrer" href="http://1.xn--acme-ke9g492u.sh">1. 安装 acme.sh</a></p><div class="highlight-wrap" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="false" data-rel="SHELL"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl https://get.acme.sh | sh</span><br></pre></td></tr></table></figure></div><p>2. 安装后的配置<br>把 <a target="_blank" rel="external nofollow noopener noreferrer" href="http://acme.sh">acme.sh</a> 安装到你的 home 目录下:~/.acme.sh/ 并创建 一个 bash 的 alias, 方便你的使用:</p><div class="highlight-wrap" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="false" data-rel="SHELL"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">alias acme.sh=~/.acme.sh/acme.sh</span><br><span class="line">echo &#x27;alias acme.sh=~/.acme.sh/acme.sh&#x27; &gt;&gt;/etc/profile</span><br></pre></td></tr></table></figure></div><p>3. 申请证书<br><a target="_blank" rel="external nofollow noopener noreferrer" href="http://acme.sh">acme.sh</a> 实现了 acme 协议支持的所有验证协议。一般有两种方式验证: http 和 dns 验证（本文不提供 dns 方式申请，dns 手动模式，不能自动更新证书。在续订证书时，您必须手动向域中添加新的 txt 记录。）</p><p>HTTP 方式方法如下：</p><div class="highlight-wrap" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="false" data-rel="SH"><figure class="iseeu highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">acme.sh --issue -d epoint.pswen.cn --webroot /nginx网站根目录</span><br></pre></td></tr></table></figure></div><p>只需要指定域名，并指定域名所在的网站根目录【命令中根目录路径】. <a target="_blank" rel="external nofollow noopener noreferrer" href="http://acme.sh">acme.sh</a> 会全自动的生成验证文件，并放到网站的根目录，然后自动完成验证。最后会聪明的删除验证文件。整个过程没有任何副作用.</p><p>4. 证书的安装<br>注意，默认生成的证书都放在安装目录下: ~/.acme.sh/, 请不要直接使用此目录下的文件，<br>例如：不要直接让 nginx/apache 的配置文件使用这下面的文件.<br>这里面的文件都是内部使用，而且目录结构可能会变化.</p><p>正确的使用方法是使用 --installcert 命令，并指定目标位置，然后证书文件会被 copy 到相应的位置，</p><p>Nginx 服务： <code>service nginx force-reload</code> 。(centos6)</p><p>Nginx 服务： <code>systemctl restart nginx</code> 。(centos7)</p><p>nginx 示例 1:</p><div class="highlight-wrap" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="false" data-rel="SHELL"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">acme.sh --installcert -d epoint.pswen.cn --key-file /usr/local/nginx/ssl_cert/epoint.pswen.cn.key --fullchain-file /usr/local/nginx/ssl_cert/epoint.pswen.cn.cer --reloadcmd &quot;service nginx force-reload&quot;</span><br></pre></td></tr></table></figure></div><p>nginx 示例 2：</p><div class="highlight-wrap" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="false" data-rel="SH"><figure class="iseeu highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">acme.sh --install-cert -d chandao.test.com \</span><br><span class="line">--key-file /usr/local/nginx/ssl_cert/test.com/chandao.test.com.key \</span><br><span class="line">--fullchain-file /usr/local/nginx/ssl_cert/test.com/chandao.test.com.cer \</span><br><span class="line">--reloadcmd      <span class="string">&quot;service nginx force-reload&quot;</span></span><br></pre></td></tr></table></figure></div><p>附带完成前面 1-4 步骤的截图：</p><p><img src="/images/loading.svg" data-original="/p/4425fc35/867078-20190326175923357-720763416.png" alt="img"></p><ol start="5"><li>Nginx 服务器安装 SSL 证书</li></ol><p>Nginx 配置 Http 和 Https 共存</p><div class="highlight-wrap" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="false" data-rel="SHELL"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">listen 80; #如果硬性要求全部走https协议，这一行去除</span><br><span class="line">listen 443 ssl http2; #如果硬性要求全部走https协议，这里去除ssl</span><br><span class="line">server_name chandao.test.com;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">ssl on; <span class="comment">#如果硬性要求全部走https协议，这里开启ssl on</span></span></span><br><span class="line">ssl_certificate /usr/local/nginx/ssl_cert/test.com/chandao.test.com.cer;</span><br><span class="line">ssl_certificate_key /usr/local/nginx/ssl_cert/test.com/chandao.test.com.key;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">ssl性能调优</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">nginx 1.13.0支持了TLSv1.3,TLSv1.3相比之前的TLSv1.2、TLSv1.1等性能大幅提升</span></span><br><span class="line">ssl_protocols TLSv1 TLSv1.1 TLSv1.2;</span><br><span class="line">ssl_ciphers EECDH+CHACHA20:EECDH+AES128:RSA+AES128:EECDH+AES256:RSA+AES256:EECDH+3DES:RSA+3DES:!MD5;</span><br><span class="line">ssl_prefer_server_ciphers on;</span><br><span class="line">ssl_session_timeout 10m;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">使用ssl_session_cache优化https下Nginx的性能</span></span><br><span class="line">ssl_session_cache builtin:1000 shared:SSL:10m;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">OCSP Stapling 开启。OCSP是用于在线查询证书吊销情况的服务，使用OCSP Stapling能将证书有效状态的信息缓存到服务器，提高 TLS 握手速度</span></span><br><span class="line">ssl_stapling on;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">OCSP Stapling 验证开启</span></span><br><span class="line">ssl_stapling_verify on; </span><br></pre></td></tr></table></figure></div><p>完整例子：</p><div class="highlight-wrap" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="false" data-rel="SHELL"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">  listen 80;  #如果硬性要求全部走https协议，这一行去除</span><br><span class="line">  listen       443 ssl http2;    #如果硬性要求全部走https协议，这里去除ssl</span><br><span class="line">  server_name chandao.test.com;</span><br><span class="line">  access_log off;</span><br><span class="line">  index index.html index.htm index.php;</span><br><span class="line">  root /data/wwwroot/chandao;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">  #</span><span class="language-bash">ssl on;   <span class="comment">#如果硬性要求全部走https协议，这里开启ssl on</span></span></span><br><span class="line">  ssl_certificate   /usr/local/nginx/ssl_cert/test.com/chandao.test.com.cer;</span><br><span class="line">  ssl_certificate_key  /usr/local/nginx/ssl_cert/test.com/chandao.test.com.key;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">  #</span><span class="language-bash">ssl性能调优</span></span><br><span class="line"><span class="meta prompt_">  #</span><span class="language-bash">nginx 1.13.0支持了TLSv1.3,TLSv1.3相比之前的TLSv1.2、TLSv1.1等性能大幅提升</span></span><br><span class="line">  ssl_protocols TLSv1 TLSv1.1 TLSv1.2;</span><br><span class="line">  ssl_ciphers EECDH+CHACHA20:EECDH+AES128:RSA+AES128:EECDH+AES256:RSA+AES256:EECDH+3DES:RSA+3DES:!MD5;</span><br><span class="line">  ssl_prefer_server_ciphers on;</span><br><span class="line">  ssl_session_timeout 10m;</span><br><span class="line"><span class="meta prompt_">  #</span><span class="language-bash">使用ssl_session_cache优化https下Nginx的性能</span></span><br><span class="line">  ssl_session_cache builtin:1000 shared:SSL:10m;</span><br><span class="line"><span class="meta prompt_">  #</span><span class="language-bash">OCSP Stapling 开启。OCSP是用于在线查询证书吊销情况的服务，使用OCSP Stapling能将证书有效状态的信息缓存到服务器，提高 TLS 握手速度</span></span><br><span class="line">  ssl_stapling on;</span><br><span class="line"><span class="meta prompt_">  #</span><span class="language-bash">OCSP Stapling 验证开启</span></span><br><span class="line">  ssl_stapling_verify on; </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">  #</span><span class="language-bash">error_page 404 /404.html;</span></span><br><span class="line"><span class="meta prompt_">  #</span><span class="language-bash">error_page 502 /502.html;</span></span><br><span class="line"></span><br><span class="line">  location ~ [^/]\.php(/|$) &#123;</span><br><span class="line">    #fastcgi_pass remote_php_ip:9000;</span><br><span class="line">    fastcgi_pass unix:/dev/shm/php-cgi.sock;</span><br><span class="line">    fastcgi_index index.php;</span><br><span class="line">    include fastcgi.conf;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  location ~ .*\.(gif|jpg|jpeg|png|bmp|swf|flv|mp4|ico)$ &#123;</span><br><span class="line">    expires 30d;</span><br><span class="line">    access_log off;</span><br><span class="line">  &#125;</span><br><span class="line">  location ~ .*\.(js|css)?$ &#123;</span><br><span class="line">    expires 7d;</span><br><span class="line">    access_log off;</span><br><span class="line">  &#125;</span><br><span class="line">  location ~ /\.ht &#123;</span><br><span class="line">    deny all;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><p>6. 重启 nginx<br>保存退出后，通过 nginx -t 来检查配置文件是否正确，有错误的话改之即可。配置文件检测正确之后，通过 service nginx force-reload 来重载配置文件。</p><div class="highlight-wrap" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="false" data-rel="SHELL"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">nginx -t</span><br><span class="line">systemctl restart nginx</span><br></pre></td></tr></table></figure></div></div></div><div class="article-footer"><div class="article-meta pull-left"><span class="post-tags"><i class="icon-tags"></i> <a href="/tags/linux/">linux</a><a href="/tags/acmesh/">acmesh</a><a href="/tags/域名证书/">域名证书</a></span></div></div></article></div><link rel="stylesheet" href="/js/readmore/readmore.css" media="screen" type="text/css"><script src="/js/readmore/readmore.js" type="text/javascript"></script><script>const btw=new BTWPlugin;btw.init({id:"container",blogId:"31136-1676194002310-704",name:"浪漫宇宙与人间日常",qrcode:"/qrcode.jpg",keyword:"人间日常"})</script></main><footer class="site-footer"><p class="mp"><img alt="关注我" src="/mp.png" style="border-radius:10px" no-lazy></p><p class="site-info">湘ICP备2020021380号-1<br>&copy; 2014 - 2023 SIWEN.PENG</p></footer><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script"),c=(e.src="//hm.baidu.com/hm.js?83fbb968d837cac86cb15c97ddd8cdd4",document.getElementsByTagName("script")[0]);c.parentNode.insertBefore(e,c)}()</script></div></div><style>[bg-lazy]{background-image:none!important;background-color:#eee!important}</style><script>window.imageLazyLoadSetting={isSPA:!1,preloadRatio:1,processImages:null}</script><script>window.addEventListener("load",function(){var a=/\.(gif|jpg|jpeg|tiff|png)$/i,e=/^data:image\/[a-z]+;base64,/;Array.prototype.slice.call(document.querySelectorAll("img[data-original]")).forEach(function(t){var r=t.parentNode;"A"===r.tagName&&(r.href.match(a)||r.href.match(e))&&(r.href=t.dataset.original)})})</script><script>!function(t){function e(){var t=Array.prototype.slice.call(document.querySelectorAll("img[data-original]")),e=Array.prototype.slice.call(document.querySelectorAll("[bg-lazy]"));return t.concat(e)}function n(){i&&(r=e());for(var n,a=0;a<r.length;a++)0<=(n=(n=r[a]).getBoundingClientRect()).bottom&&0<=n.left&&n.top<=(t.innerHeight*o||document.documentElement.clientHeight*o)&&function(){var e,n,i,o=r[a],c=function(){r=r.filter(function(t){return o!==t}),t.imageLazyLoadSetting.onImageLoaded&&t.imageLazyLoadSetting.onImageLoaded(o)};(e=o).hasAttribute("bg-lazy")?(e.removeAttribute("bg-lazy"),c()):(n=new Image,i=e.getAttribute("data-original"),n.onload=function(){e.src=i,e.removeAttribute("data-original"),c()},e.src!==i&&(n.src=i))}()}function a(){clearTimeout(n.tId),n.tId=setTimeout(n,500)}t.imageLazyLoadSetting.processImages=n;var i=t.imageLazyLoadSetting.isSPA,o=t.imageLazyLoadSetting.preloadRatio||1,r=e();n(),document.addEventListener("scroll",a),t.addEventListener("resize",a),t.addEventListener("orientationchange",a)}(this)</script></body></html>
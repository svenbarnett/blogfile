<!DOCTYPE HTML><html lang="zh-CN"><head><meta charset="utf-8"><title>gulp-imagemin在压缩图片 | 人间日常 | 所行皆过往，所愿皆成真</title><meta name="author" content="SIWEN.PENG"><meta name="description" content="使用gulp进行图片压缩，借助gulp-imagemin插件"><meta name="keywords" content="gulp-imagemin,压缩图片,gulp,psw,彭思文,siwen,思文,sven,java,study,solution,blog"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,minimal-ui"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta property="og:title" content="gulp-imagemin在压缩图片"><meta property="og:site_name" content="人间日常"><meta property="og:image" content="ppp"><link href="/avatar.jpg" rel="icon"><link rel="alternate" href="/atom.xml" title="人间日常" type="application/atom+xml"><link rel="stylesheet" href="/css/style.css" media="screen" type="text/css"><link rel="stylesheet" href="/css/custom.css" media="screen" type="text/css"><script src="//sdk.jinrishici.com/v2/browser/jinrishici.js" charset="utf-8"></script><meta name="generator" content="Hexo 6.3.0"></head><body><div class="blog"><div class="content"><header><div class="site-branding"><h1 class="site-title"><a href="/">人间日常</a></h1><p class="site-description">所行皆过往，所愿皆成真</p><span class="site-description" id="jinrishici-sentence">正在加载今日诗词....</span></div><nav class="site-navigation"><ul><li><a href="/">主页</a></li><li><a href="/archives/">归档</a></li><li><a href="/pics/">图记</a></li></ul></nav></header><main class="site-main posts-loop"><div id="container"><article><h3 class="article-title"><span>gulp-imagemin在压缩图片</span></h3><div class="article-top-meta"><span class="posted-on"><a href="/p/1009bbf4/" rel="bookmark"><time class="entry-date published" datetime="2021-11-16T14:35:58.000Z">2021-11-16</time></a></span></div><div class="article-content"><div class="entry"><html><head></head><body><p>经过各种研（bai）究（du），找到了一种方案：采用 <code>gulp + gulp-imagemin</code> ，对图片进行压缩，结合 hexo 进行对应图片压缩。</p><span id="more"></span><h3 id="安装"><a class="markdownIt-Anchor" href="#安装">#</a> 安装</h3><div class="highlight-wrap" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="false" data-rel="SH"><figure class="iseeu highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">npm install gulp --save-dev</span><br><span class="line">npm install gulp-imagemin --save-dev</span><br><span class="line">npm install imagemin-pngquant --save-dev</span><br><span class="line"><span class="comment"># 当然也可以--save  记得要给gulp全局安装下，npm命令不行，就是用cnpm</span></span><br><span class="line">npm install gulp -g <span class="comment"># 只有gulp要全局安装下</span></span><br></pre></td></tr></tbody></table></figure></div><h3 id="gulpfile"><a class="markdownIt-Anchor" href="#gulpfile">#</a> gulpfile</h3><p>在 package.json 同名目录下，增加 gulpfile.js 对应的入口 js 文件</p><div class="highlight-wrap" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="false" data-rel="JAVASCRIPT"><figure class="iseeu highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gulp <span class="keyword">from</span> <span class="string">'gulp'</span>;</span><br><span class="line"><span class="keyword">import</span> imagemin <span class="keyword">from</span> <span class="string">'gulp-imagemin'</span>;</span><br><span class="line"><span class="keyword">import</span> pngquant <span class="keyword">from</span> <span class="string">'imagemin-pngquant'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义一个任务 第一个参数为名称，后面时要执行的动作</span></span><br><span class="line">gulp.<span class="title function_">task</span>(<span class="string">'minify-images'</span>, <span class="keyword">function</span> (<span class="params">done</span>) {</span><br><span class="line">    gulp.<span class="title function_">src</span>(<span class="string">'public/p/**/*.{JPG,jpg,PNG,png,GIF,gif,SVG,svg,JPEG,jpeg}'</span>)</span><br><span class="line">		.<span class="title function_">pipe</span>(<span class="title function_">imagemin</span>({</span><br><span class="line">			<span class="attr">optimizationLevel</span>: <span class="number">3</span>,</span><br><span class="line">			<span class="attr">progressive</span>: <span class="literal">true</span>,</span><br><span class="line">			<span class="attr">usa</span>:[<span class="title function_">pngquant</span>()]</span><br><span class="line">		}))</span><br><span class="line">		.<span class="title function_">pipe</span>(gulp.<span class="title function_">dest</span>(<span class="string">'public/p/'</span>))</span><br><span class="line">    <span class="title function_">done</span>();</span><br><span class="line">});</span><br><span class="line"><span class="comment">// 定义default ，后面将多个任务序列化并行执行，我们只有一个</span></span><br><span class="line">gulp.<span class="title function_">task</span>(<span class="string">'default'</span>, gulp.<span class="title function_">series</span>(gulp.<span class="title function_">parallel</span>(<span class="string">'minify-images'</span>)), <span class="keyword">function</span> (<span class="params"></span>) {</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">info</span>(<span class="string">"----------gulp Finished----------"</span>);</span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure></div><p>执行命令 <code>gulp</code> 默认情况下，代表 <code>gulp default</code> 就执行你上面的 default 任务</p><p>当然你也可以制定任务名称： <code>gulp minify-images</code> 执行指定 task</p><p>然后再 hexo 状态下：</p><div class="highlight-wrap" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="false" data-rel="SH"><figure class="iseeu highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">hexo clean </span><br><span class="line">hexo g</span><br><span class="line">gulp</span><br><span class="line"><span class="comment"># 输出如下：</span></span><br><span class="line">[22:46:42] Using gulpfile ~/Desktop/blogfile/gulpfile.js</span><br><span class="line">[22:46:42] Starting <span class="string">'default'</span>...</span><br><span class="line">[22:46:42] Starting <span class="string">'minify-images'</span>...</span><br><span class="line">[22:46:42] Finished <span class="string">'minify-images'</span> after 74 ms</span><br><span class="line">[22:46:42] Finished <span class="string">'default'</span> after 99 ms</span><br></pre></td></tr></tbody></table></figure></div><p>那说明成功了</p><h3 id="遇到的坑"><a class="markdownIt-Anchor" href="#遇到的坑">#</a> 遇到的坑</h3><ul><li>引入语法问题，插件需要使用 es6 语法，故此你的 package.json 需要增加一个参数 <code>"type": "module"</code> 如此你可以再 gulpfile.js 中使用 es6 的 import 语法</li></ul></body></html></div></div><div class="article-footer"><div class="article-meta pull-left"><span class="post-tags"><i class="icon-tags"></i> <a href="/tags/gulp/">gulp</a><a href="/tags/压缩图片/">压缩图片</a><a href="/tags/gulp-imagemin/">gulp-imagemin</a></span></div></div></article></div></main><footer class="site-footer"><p class="mp"><img alt="关注我" src="/mp.png" style="border-radius:10px" no-lazy></p><p class="site-info">湘ICP备2020021380号-1<br>&copy; 2014 - 2023 SIWEN.PENG</p></footer><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script"),c=(e.src="//hm.baidu.com/hm.js?83fbb968d837cac86cb15c97ddd8cdd4",document.getElementsByTagName("script")[0]);c.parentNode.insertBefore(e,c)}()</script></div></div><style>[bg-lazy]{background-image:none!important;background-color:#eee!important}</style><script>window.imageLazyLoadSetting={isSPA:!1,preloadRatio:1,processImages:null}</script><script>window.addEventListener("load",function(){var a=/\.(gif|jpg|jpeg|tiff|png)$/i,e=/^data:image\/[a-z]+;base64,/;Array.prototype.slice.call(document.querySelectorAll("img[data-original]")).forEach(function(t){var r=t.parentNode;"A"===r.tagName&&(r.href.match(a)||r.href.match(e))&&(r.href=t.dataset.original)})})</script><script>!function(t){function e(){var t=Array.prototype.slice.call(document.querySelectorAll("img[data-original]")),e=Array.prototype.slice.call(document.querySelectorAll("[bg-lazy]"));return t.concat(e)}function n(){i&&(r=e());for(var n,a=0;a<r.length;a++)0<=(n=(n=r[a]).getBoundingClientRect()).bottom&&0<=n.left&&n.top<=(t.innerHeight*o||document.documentElement.clientHeight*o)&&function(){var e,n,i,o=r[a],c=function(){r=r.filter(function(t){return o!==t}),t.imageLazyLoadSetting.onImageLoaded&&t.imageLazyLoadSetting.onImageLoaded(o)};(e=o).hasAttribute("bg-lazy")?(e.removeAttribute("bg-lazy"),c()):(n=new Image,i=e.getAttribute("data-original"),n.onload=function(){e.src=i,e.removeAttribute("data-original"),c()},e.src!==i&&(n.src=i))}()}function a(){clearTimeout(n.tId),n.tId=setTimeout(n,500)}t.imageLazyLoadSetting.processImages=n;var i=t.imageLazyLoadSetting.isSPA,o=t.imageLazyLoadSetting.preloadRatio||1,r=e();n(),document.addEventListener("scroll",a),t.addEventListener("resize",a),t.addEventListener("orientationchange",a)}(this)</script></body></html>
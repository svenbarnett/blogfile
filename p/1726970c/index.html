<!DOCTYPE HTML><html lang="zh-CN"><head><meta charset="utf-8"><title>文件下载原理详解和解决方案 | 人间日常 | 所行皆过往，所愿皆成真</title><meta name="author" content="SIWEN.PENG"><meta name="description" content="文件下载在文件大小、网络带宽等限制下就会呈现劣化趋势，故此要解决特殊手段解决"><meta name="keywords" content="文件下载,P2P,分片下载,psw,彭思文,siwen,思文,sven,java,study,solution,blog"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,minimal-ui"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta property="og:title" content="文件下载原理详解和解决方案"><meta property="og:site_name" content="人间日常"><meta property="og:image" content="/avatar.jpg"><link href="/avatar.jpg" rel="icon"><link rel="alternate" href="/atom.xml" title="人间日常" type="application/atom+xml"><link rel="stylesheet" href="/css/style.css" media="screen" type="text/css"><link rel="stylesheet" href="/css/custom.css" media="screen" type="text/css"><script src="//sdk.jinrishici.com/v2/browser/jinrishici.js" charset="utf-8"></script><meta name="generator" content="Hexo 6.3.0"></head><body><div class="blog"><div class="content"><header><div class="site-branding"><h1 class="site-title"><a href="/">人间日常</a></h1><p class="site-description">所行皆过往，所愿皆成真</p><span class="site-description" id="jinrishici-sentence">正在加载今日诗词....</span></div><nav class="site-navigation"><ul><li><a href="/">主页</a></li><li><a href="/archives/index.html">归档</a></li><li><a href="/pics/index.html">图记</a></li></ul></nav></header><main class="site-main posts-loop"><div id="container"><article><h3 class="article-title"><span>文件下载原理详解和解决方案</span></h3><div class="article-top-meta"><span class="posted-on"><a href="/p/1726970c/index.html" rel="bookmark"><time class="entry-date published" datetime="2023-07-08T13:41:08.000Z">2023-07-08</time></a></span></div><div class="article-content"><div class="entry"><html><head></head><body><p>对于文件服务器通常会面临大量文件下载请求，除了带宽、IO 等硬件上的约束条件外，在极度消耗影响资源情况下，非常容易对文件服务器造成压力，导致服务器崩溃，故此需要通过一些技术手段保证服务器稳定，并且也能持有一定下载速度。</p><h2 id="文件下载的几种优化方式"><a class="markdownIt-Anchor" href="#文件下载的几种优化方式">#</a> 文件下载的几种优化方式</h2><p>1、CDN 加速，主要就是将对应文件缓存到各个 CDN 节点，后续就近给用户访问最优节点</p><p>如图：<img src="/images/loading.svg" data-original="/p/1726970c/index/image-20230708215634360.png" alt="CDN示意图"></p><p>2、S3 存储，主要是强调文件存储，特点是用户海量、无限扩容、廉价，同时远程访问速度通过全球节点，速度都有保证，它综合了 NAS 和 SAN 的优点，同时具有 SAN 的高速直接访问和 NAS 的分布式数据共享等优势，提供了具有高性能、高可靠性、跨平台以及安全的数据共享的存储体系结构。</p><p>3、客户端并发多线程下载，该方式是常用方式</p><p>4、客户端分片并发下载，通常配合断点续传</p><p>5、P2P 技术，传统的下载是 C/S 模式，即提供资源的人作为唯一的服务器，需要下载资源的人，都向这个唯一的服务器发送请求，当同时存在多个下载请求时，服务器的下载速率就会大大降低，因此 P2P 下载出现了。P2P 下载是一种分布式存在下载速率受限的情况。</p><blockquote><p><strong>综合分析来看</strong></p><p>对于 CDN 技术主要针对公共资源类文件，大家都可以统一访问，而 S3 主要作为一种存储服务，对文件的管理粒度无法和业务更好切合，那对于优化文件加速，常用主要是通过多线程并发下载、分片并发下载，而 P2P 技术似乎可以看作一个终极解决大量文件下载对服务端压力的解决方案</p></blockquote><h3 id="文件下载优化手段"><a class="markdownIt-Anchor" href="#文件下载优化手段">#</a> 文件下载优化手段</h3><p>主要介绍多线程并发下载、分片并发下载和 P2P 技术</p><h4 id="多线程并发下载"><a class="markdownIt-Anchor" href="#多线程并发下载">#</a> 多线程并发下载</h4><p>针对需要下载多个批量文件，通过通过线程池，多个文件并行下载，此举会对服务端带宽、IO 造成极大压力，会最大程度消耗硬件网络资源，并且该方式主要是针对多个文件，文件不可中断，中断后必须重新下载，而且，对于其中有大文件还会导致长时间连接的 http</p><h4 id="分片并发下载"><a class="markdownIt-Anchor" href="#分片并发下载">#</a> 分片并发下载</h4><p>主要通过 http 协议中 Range 请求头来进行控制，通过它来控制下载对应的数据块，并且此方法还可以兼容普通下载，此方法同样支持普通下载，不传入 Range 头就可进行普通下载；也可一次只下载一段（传入一个 range:bytes=0-10240）；也可下载多段 (传入多个 range:bytes=0-10240,10241-20480)；也可一次下载完文件（range 范围为整个文件即可:bytes=0-102400）</p><p>同时，块之间可以并发下载，只需要在最后一块任务执行完成后，进行文件合并操作即可；并且如此客户端还可以做断点续传</p><h4 id="p2p技术"><a class="markdownIt-Anchor" href="#p2p技术">#</a> P2P 技术</h4><p>传统的 http 下载是从服务器上直接复制数据给客户端，这种传输方式对于速度的限制很大，主要是带宽的限制，如果一个服务器的带宽是 100，而同时有十个人在这个服务器中下载文件，那么每个人的带宽就会受到限制只有 10，在早期下载器开会员可以下载的更快，就是给会员分配到了更快的带宽中了，但是不管怎么划分，资源还是有限的，像是那些超大型网站，特定时段有上亿的点击量，所以为了应付庞大的下载量 p2p 就应运而生了。<br>而运用 p2p 下载时，服务器与 http 中所担任的责任不同，这回服务器只负责将文件的基本信息放在客户端之间，而自己并没有文件，而 p2p 软件将一个文件拆分成多份，而客户端可以下载这若干份中的一个，就像一杯水被分成若干份，最后倒在一起还是那一杯水，另外相对于 HTTP 的下载方式如果服务器停机了你就下不了了，但是 p2p 不同如果服务器停机了你可以下载别人的这个文件，而你在下载别人的文件的同时也在将自己所下载的文件共享出去。可以说下载的用户越多下载的越快。<br>另外 P2P 传输中有 “种子” 这种说法。所谓的 “种子”，就是指那些已经将文件下载完成的人，他们拥有全部的区块。发布资源的人自己就有一个完整的文件，所以下载时人们会先下载他的完整文件，直到更多的完整完整种子出现。当种子消失时会发生两种情况，一是缺少区块，剩下的客户端最多下载到完全相同的进度；另一种就是区块正好完整，只不过分布在不同的客户端上而已，这样下去就会有人下载完，成为种子。所以 p2p 可以将一个文件不断的变成种子在不同中的用户间传播。</p></body></html></div></div><div class="article-footer"><div class="article-meta pull-left"><span class="post-tags"><i class="icon-tags"></i> <a href="/tags/文件下载/">文件下载</a><a href="/tags/P2P/">P2P</a><a href="/tags/分片下载/">分片下载</a></span></div></div></article></div></main><footer class="site-footer"><p class="mp"><img alt="关注我" src="/mp.png" style="border-radius:10px" no-lazy></p><p class="site-info">湘ICP备2020021380号-1<br>&copy; 2014 - 2023 SIWEN.PENG</p></footer><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script"),c=(e.src="//hm.baidu.com/hm.js?83fbb968d837cac86cb15c97ddd8cdd4",document.getElementsByTagName("script")[0]);c.parentNode.insertBefore(e,c)}()</script></div></div><style>[bg-lazy]{background-image:none!important;background-color:#eee!important}</style><script>window.imageLazyLoadSetting={isSPA:!1,preloadRatio:1,processImages:null}</script><script>window.addEventListener("load",function(){var a=/\.(gif|jpg|jpeg|tiff|png)$/i,e=/^data:image\/[a-z]+;base64,/;Array.prototype.slice.call(document.querySelectorAll("img[data-original]")).forEach(function(t){var r=t.parentNode;"A"===r.tagName&&(r.href.match(a)||r.href.match(e))&&(r.href=t.dataset.original)})})</script><script>!function(t){function e(){var t=Array.prototype.slice.call(document.querySelectorAll("img[data-original]")),e=Array.prototype.slice.call(document.querySelectorAll("[bg-lazy]"));return t.concat(e)}function n(){i&&(r=e());for(var n,a=0;a<r.length;a++)0<=(n=(n=r[a]).getBoundingClientRect()).bottom&&0<=n.left&&n.top<=(t.innerHeight*o||document.documentElement.clientHeight*o)&&function(){var e,n,i,o=r[a],c=function(){r=r.filter(function(t){return o!==t}),t.imageLazyLoadSetting.onImageLoaded&&t.imageLazyLoadSetting.onImageLoaded(o)};(e=o).hasAttribute("bg-lazy")?(e.removeAttribute("bg-lazy"),c()):(n=new Image,i=e.getAttribute("data-original"),n.onload=function(){e.src=i,e.removeAttribute("data-original"),c()},e.src!==i&&(n.src=i))}()}function a(){clearTimeout(n.tId),n.tId=setTimeout(n,500)}t.imageLazyLoadSetting.processImages=n;var i=t.imageLazyLoadSetting.isSPA,o=t.imageLazyLoadSetting.preloadRatio||1,r=e();n(),document.addEventListener("scroll",a),t.addEventListener("resize",a),t.addEventListener("orientationchange",a)}(this)</script></body></html>
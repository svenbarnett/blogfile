{"name":"压缩图片","postlist":[{"title":"gulp-imagemin在压缩图片","slug":"gulp-imagemin-use","date":"2021-11-16T14:35:58.000Z","updated":"2023-02-09T13:16:25.598Z","comments":null,"realpath":null,"path":"api/articles/gulp-imagemin-use.json","excerpt":"经过各种研（bai）究（du），找到了一种方案：采用 gulp + gulp-imagemin ，对图片进行压缩，结合 hexo 进行对应图片压缩。","keywords":"gulp-imagemin,压缩图片,gulp","cover":"/p/1009bbf4/ppp","content":"<p>经过各种研（bai）究（du），找到了一种方案：采用 <code>gulp + gulp-imagemin</code> ，对图片进行压缩，结合 hexo 进行对应图片压缩。</p>\n<span id=\"more\"></span>\n<h3 id=\"安装\"><a class=\"markdownIt-Anchor\" href=\"#安装\">#</a> 安装</h3>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install gulp --save-dev</span><br><span class=\"line\">npm install gulp-imagemin --save-dev</span><br><span class=\"line\">npm install imagemin-pngquant --save-dev</span><br><span class=\"line\"><span class=\"comment\"># 当然也可以--save  记得要给gulp全局安装下，npm命令不行，就是用cnpm</span></span><br><span class=\"line\">npm install gulp -g <span class=\"comment\"># 只有gulp要全局安装下</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"gulpfile\"><a class=\"markdownIt-Anchor\" href=\"#gulpfile\">#</a> gulpfile</h3>\n<p>在 package.json 同名目录下，增加 gulpfile.js 对应的入口 js 文件</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> gulp <span class=\"keyword\">from</span> <span class=\"string\">&#x27;gulp&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> imagemin <span class=\"keyword\">from</span> <span class=\"string\">&#x27;gulp-imagemin&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> pngquant <span class=\"keyword\">from</span> <span class=\"string\">&#x27;imagemin-pngquant&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 定义一个任务 第一个参数为名称，后面时要执行的动作</span></span><br><span class=\"line\">gulp.<span class=\"title function_\">task</span>(<span class=\"string\">&#x27;minify-images&#x27;</span>, <span class=\"keyword\">function</span> (<span class=\"params\">done</span>) &#123;</span><br><span class=\"line\">    gulp.<span class=\"title function_\">src</span>(<span class=\"string\">&#x27;public/p/**/*.&#123;JPG,jpg,PNG,png,GIF,gif,SVG,svg,JPEG,jpeg&#125;&#x27;</span>)</span><br><span class=\"line\">\t\t.<span class=\"title function_\">pipe</span>(<span class=\"title function_\">imagemin</span>(&#123;</span><br><span class=\"line\">\t\t\t<span class=\"attr\">optimizationLevel</span>: <span class=\"number\">3</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">progressive</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">usa</span>:[<span class=\"title function_\">pngquant</span>()]</span><br><span class=\"line\">\t\t&#125;))</span><br><span class=\"line\">\t\t.<span class=\"title function_\">pipe</span>(gulp.<span class=\"title function_\">dest</span>(<span class=\"string\">&#x27;public/p/&#x27;</span>))</span><br><span class=\"line\">    <span class=\"title function_\">done</span>();</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"><span class=\"comment\">// 定义default ，后面将多个任务序列化并行执行，我们只有一个</span></span><br><span class=\"line\">gulp.<span class=\"title function_\">task</span>(<span class=\"string\">&#x27;default&#x27;</span>, gulp.<span class=\"title function_\">series</span>(gulp.<span class=\"title function_\">parallel</span>(<span class=\"string\">&#x27;minify-images&#x27;</span>)), <span class=\"keyword\">function</span> (<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">info</span>(<span class=\"string\">&quot;----------gulp Finished----------&quot;</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>执行命令 <code>gulp</code>  默认情况下，代表 <code>gulp default</code>  就执行你上面的 default 任务</p>\n<p>当然你也可以制定任务名称： <code>gulp minify-images</code>  执行指定 task</p>\n<p>然后再 hexo 状态下：</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hexo clean </span><br><span class=\"line\">hexo g</span><br><span class=\"line\">gulp</span><br><span class=\"line\"><span class=\"comment\"># 输出如下：</span></span><br><span class=\"line\">[22:46:42] Using gulpfile ~/Desktop/blogfile/gulpfile.js</span><br><span class=\"line\">[22:46:42] Starting <span class=\"string\">&#x27;default&#x27;</span>...</span><br><span class=\"line\">[22:46:42] Starting <span class=\"string\">&#x27;minify-images&#x27;</span>...</span><br><span class=\"line\">[22:46:42] Finished <span class=\"string\">&#x27;minify-images&#x27;</span> after 74 ms</span><br><span class=\"line\">[22:46:42] Finished <span class=\"string\">&#x27;default&#x27;</span> after 99 ms</span><br></pre></td></tr></table></figure>\n<p>那说明成功了</p>\n<h3 id=\"遇到的坑\"><a class=\"markdownIt-Anchor\" href=\"#遇到的坑\">#</a> 遇到的坑</h3>\n<ul>\n<li>引入语法问题，插件需要使用 es6 语法，故此你的 package.json 需要增加一个参数 <code>  &quot;type&quot;: &quot;module&quot;</code>  如此你可以再 gulpfile.js 中使用 es6 的 import 语法</li>\n</ul>\n","raw":null,"categories":[],"tags":[{"name":"gulp","path":"api/tags/gulp.json"},{"name":"压缩图片","path":"api/tags/压缩图片.json"},{"name":"gulp-imagemin","path":"api/tags/gulp-imagemin.json"}]}]}